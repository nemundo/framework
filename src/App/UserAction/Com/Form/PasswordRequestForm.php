<?phpnamespace Nemundo\App\UserAction\Com\Form;use Nemundo\Admin\Com\Form\AbstractAdminForm;use Nemundo\Admin\Com\ListBox\AdminEmailBox;use Nemundo\App\Mail\MailConfig;use Nemundo\App\Mail\Message\Mail\ActionMailMessage;use Nemundo\App\Mail\Message\Mail\MailMessage;use Nemundo\App\UserAction\Site\PasswordResetSite;use Nemundo\User\Parameter\SecureTokenParameter;use Nemundo\User\Type\UserType;class PasswordRequestForm extends AbstractAdminForm{    /**     * @var AdminEmailBox     */    private $login;    protected function loadContainer()    {        parent::loadContainer();        $this->submitButton->label = 'Passwort anfordern';    }    public function getContent()    {        $this->login = new AdminEmailBox($this);        $this->login->label = 'eMail';        $this->login->name = 'password_request_login';        $this->login->validation = true;        $this->login->autofocus = true;        return parent::getContent();    }    public function onValidate()    {        $userType = (new UserType())->fromLogin($this->login->getValue());        $check = $userType->existsUser();        if (!$check) {            $this->login->errorMessage = 'User nicht vorhanden';            $this->login->showErrorMessage = true;        }        return $check;    }    protected function onSubmit()    {        // PasswordRequestBuilder        $subject = 'Passwort wiederherstellen';  //$passwordRequest->subject;        $userType = (new UserType())->fromLogin($this->login->getValue());        $userRow = $userType->getUserRow();        //$site = clone(UserActivationSite::$site);        $site = clone(PasswordResetSite::$site);        $site->title = $subject;        $site->addParameter(new SecureTokenParameter($userRow->secureToken));        $mailDocument = (new MailConfig())->getActionMailDocument();        $mailDocument->mailTitle = $subject;        $mailDocument->mailText = 'Setzen sie das Passwort f√ºr das Login: <b>' . $userRow->login . '</b>';        $mailDocument->actionSite = $site;        $mailMessage = new ActionMailMessage();  // new MailMessage();        $mailMessage->mailTo = $userRow->email;        $mailMessage->subject = $subject;        $mailMessage->mailContainer = $mailDocument;        //$mailMessage->text = $mailDocument->getHtml();        $mailMessage->sendMail();    }}