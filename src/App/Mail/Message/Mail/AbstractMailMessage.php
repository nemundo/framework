<?phpnamespace Nemundo\App\Mail\Message\Mail;use Nemundo\App\Mail\Data\Attachment\Attachment;use Nemundo\App\Mail\Data\InlineImage\InlineImage;use Nemundo\App\Mail\Data\MailQueue\MailQueue;use Nemundo\App\Mail\Data\MailServer\MailServerReader;use Nemundo\App\Mail\Message\Base\AbstractMessage;use Nemundo\Core\Log\LogMessage;use Nemundo\Core\Validation\EmailValidation;abstract class AbstractMailMessage extends AbstractMessage{    /**     * @var string     */    protected $mailTo;    /**     * @var string     */    protected $subject;    /**     * @var string     */    protected $text;    protected $mailServerId;    /*public function __construct()    {        parent::__construct();        $this->loadMailMessage();    }*/    protected function loadMailMessage()    {    }    public function sendMail()    {        if ((new EmailValidation())->isEmail($this->mailTo)) {            if ($this->mailServerId == null) {                $n=0;                $reader = new MailServerReader();                $reader->filter->andEqual($reader->model->active, true);                foreach ($reader->getData() as $mailServerRow) {                    $this->mailServerId = $mailServerRow->id;                    $n++;                }                if ($n==0) {                    (new LogMessage())->writeError('No Smtp Connection found');                }            }            $data = new MailQueue();            $data->mailTo = $this->mailTo;            $data->subject = $this->subject;            $data->text = $this->text;            $data->send = false;            $data->mailServerId = $this->mailServerId;            $mailQueueId = $data->save();            foreach ($this->inlineImageList as $inlineImage) {                $data = new InlineImage();                $data->mailQueueId = $mailQueueId;                $data->cid = $inlineImage->cid;                $data->filename = $inlineImage->filename;                $data->save();            }            foreach ($this->attachmentList as $fileAttachment) {                $data = new Attachment();                $data->mailQueueId = $mailQueueId;                $data->filename = $fileAttachment->filename;                if ($fileAttachment->customFilename !== null) {                    $data->hasCustomFilename = true;                    $data->customFilename = $fileAttachment->customFilename;                } else {                    $data->hasCustomFilename = true;                }                $data->save();            }        } else {            (new LogMessage())->writeError('MailMessage: No valid eMail ' . $this->mailTo);        }    }}